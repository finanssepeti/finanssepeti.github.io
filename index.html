<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Finans Sepeti | Profesyonel Terminal</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root { --p: #0f172a; --s: #10b981; --d: #ef4444; --accent: #3b82f6; --bg: #f1f5f9; }
        body { font-family: 'Inter', sans-serif; background: var(--bg); margin: 0; color: #1e293b; }
        header { background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%); color: white; padding: 30px; text-align: center; border-bottom: 5px solid var(--accent); }
        .nav-tabs { background: white; display: flex; justify-content: center; position: sticky; top: 0; z-index: 1000; box-shadow: 0 4px 10px rgba(0,0,0,0.05); }
        .tab-btn { padding: 18px 20px; border: none; background: none; font-weight: 700; cursor: pointer; color: #64748b; display: flex; align-items: center; gap: 8px; }
        .tab-btn.active { color: var(--accent); border-bottom: 4px solid var(--accent); background: #f8fafc; }
        .container { padding: 25px; max-width: 1400px; margin: auto; }
        .card { background: white; padding: 25px; border-radius: 16px; box-shadow: 0 4px 12px rgba(0,0,0,0.05); margin-bottom: 20px; }
        .search-results { position: absolute; width: 100%; background: white; z-index: 100; border: 1px solid #ddd; border-radius: 8px; max-height: 200px; overflow-y: auto; display: none; }
        .search-item { padding: 12px; cursor: pointer; border-bottom: 1px solid #eee; }
        input { padding: 14px; margin: 10px 0; width: 100%; border-radius: 10px; border: 2px solid #e2e8f0; box-sizing: border-box; }
        .calc-box { background: var(--p); color: white; padding: 20px; border-radius: 12px; text-align: center; font-size: 1.3rem; font-weight: 800; border-right: 8px solid var(--s); margin: 15px 0; }
        .page { display: none; } .page.active { display: block; }
        #tv_container { height: 700px; border-radius: 16px; overflow: hidden; border: 1px solid #ddd; }
    </style>
</head>
<body>

<header>
    <h3 style="margin:0; opacity:0.8; font-size:0.9rem; letter-spacing:2px;">FİNANSAL YATIRIM VE TEKNİK ANALİZ</h3>
    <h1 id="clock" style="margin:10px 0;">00:00:00</h1>
    <div style="font-size:0.8rem;"><i class="fas fa-globe"></i> Canlı Veri & Haber Terminali</div>
</header>

<div class="nav-tabs">
    <button class="tab-btn active" onclick="showPage('piyasalar')"><i class="fas fa-chart-line"></i> Piyasalar</button>
    <button class="tab-btn" onclick="showPage('yatirim-ekle')"><i class="fas fa-plus-circle"></i> Yatırım Ekle</button>
    <button class="tab-btn" onclick="showPage('portfoyum')"><i class="fas fa-wallet"></i> Portföyüm</button>
    <button class="tab-btn" onclick="showPage('teknik-analiz')"><i class="fas fa-microchip"></i> Teknik Analiz</button>
    <button class="tab-btn" onclick="showPage('haberler')"><i class="fas fa-newspaper"></i> Haberler</button>
</div>

<div class="container">
    <div id="piyasalar" class="page active">
        <div class="card" id="price-list" style="display:grid; grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); gap:15px;">Fiyatlar yükleniyor...</div>
    </div>

    <div id="yatirim-ekle" class="page">
        <div class="card" style="max-width: 550px; margin: auto;">
            <div style="position:relative">
                <input type="text" id="a-search" placeholder="Varlık Ara (BTC, EREGL, Altın...)" onkeyup="search()">
                <div id="search-results" id="s-res"></div>
            </div>
            <div id="sel-info" style="display:none; padding:15px; background:#f0f9ff; border-radius:12px; margin-bottom:15px; border:1px solid #bae6fd;">
                Varlık: <strong id="sel-n"></strong> | Fiyat: <strong id="sel-p">0.00</strong> ₺
            </div>
            <input type="number" id="a-amt" placeholder="Miktar (Adet/Gram)" oninput="calculate()">
            <input type="number" id="a-buy" placeholder="Alış Birim Fiyatı" oninput="calculate()">
            <div class="calc-box">TOPLAM TUTAR: <span id="a-total">0.00</span> ₺</div>
            <input type="date" id="a-date">
            <button onclick="save()" style="width:100%; padding:15px; background:var(--accent); color:white; border:none; border-radius:10px; font-weight:bold; cursor:pointer;">PORTFÖYE KAYDET</button>
        </div>
    </div>

    <div id="portfoyum" class="page">
        <div class="card">
            <table id="p-table" style="width:100%; border-collapse:collapse;">
                <thead style="background:#f8fafc"><tr><th style="padding:15px;">Tarih</th><th>Varlık</th><th>Miktar</th><th>Maliyet</th><th>Güncel</th><th>K/Z</th></tr></thead>
                <tbody id="p-body"></tbody>
            </table>
        </div>
    </div>

    <div id="teknik-analiz" class="page">
        <div id="tv_container"></div>
    </div>

    <div id="haberler" class="page">
        <div class="card" id="news-list">Haberler yükleniyor...</div>
    </div>
</div>

<script type="text/javascript" src="https://s3.tradingview.com/tv.js"></script>
<script>
    const API_KEY = '72ce0236fb66434e8feed08c1b2044d2';
    let livePrices = {};

    function showPage(id) {
        document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        if(id === 'teknik-analiz') loadTV();
        if(id === 'haberler') fetchNews();
    }

    async function fetchAll() {
        try {
            const syms = "XAU/USD,XAG/USD,USD/TRY,BTC/USD,XU100";
            const r = await fetch(`https://api.twelvedata.com/price?symbol=${syms}&apikey=${API_KEY}`);
            const d = await r.json();
            const usd = parseFloat(d['USD/TRY'].price);
            livePrices = {
                "ALTIN_GR": ((parseFloat(d['XAU/USD'].price) / 31.1) * usd).toFixed(2),
                "GUMUS_GR": ((parseFloat(d['XAG/USD']?.price || 32.5) / 31.1) * usd).toFixed(2),
                "USD_TRY": usd.toFixed(4),
                "BTC_TL": (parseFloat(d['BTC/USD'].price) * usd).toLocaleString()
            };
            document.getElementById('price-list').innerHTML = Object.entries(livePrices).map(([n,v]) => `<div class="card" style="margin:0; text-align:center;">${n}<br><b>${v}</b></div>`).join('');
        } catch(e) {}
    }

    async function search() {
        const q = document.getElementById('a-search').value;
        const res = document.getElementById('search-results');
        if(q.length < 2) { res.style.display='none'; return; }
        const r = await fetch(`https://api.twelvedata.com/symbol_search?symbol=${q}&apikey=${API_KEY}`);
        const data = await r.json();
        res.innerHTML = data.data.slice(0,6).map(i => `<div class="search-item" onclick="selAsset('${i.symbol}')">${i.symbol} - ${i.instrument_name}</div>`).join('');
        res.style.display = 'block';
    }

    async function selAsset(s) {
        document.getElementById('search-results').style.display='none';
        document.getElementById('a-search').value = s;
        let sym = s.includes(".") || s.includes("/") ? s : s + ".IS";
        const r = await fetch(`https://api.twelvedata.com/price?symbol=${sym}&apikey=${API_KEY}`);
        const d = await r.json();
        const p = parseFloat(d.price) || 0;
        document.getElementById('sel-n').innerText = s;
        document.getElementById('sel-p').innerText = p.toFixed(4);
        document.getElementById('a-buy').value = p.toFixed(4);
        document.getElementById('sel-info').style.display = 'block';
        calculate();
    }

    function calculate() {
        const amt = parseFloat(document.getElementById('a-amt').value) || 0;
        const buy = parseFloat(document.getElementById('a-buy').value) || 0;
        document.getElementById('a-total').innerText = (amt * buy).toLocaleString('tr-TR', {minimumFractionDigits: 2});
    }

    function loadTV() {
        new TradingView.widget({
            "autosize": true, "symbol": "BIST:XU100", "interval": "D", "timezone": "Europe/Istanbul",
            "theme": "light", "style": "1", "locale": "tr", "toolbar_bg": "#f1f3f6",
            "enable_publishing": false, "allow_symbol_change": true, "hide_side_toolbar": false,
            "container_id": "tv_container",
            "studies": ["RSI@tv-basicstudies", "MASimple@tv-basicstudies", "MASimple@tv-basicstudies"]
        });
    }

    async function fetchNews() {
        const r = await fetch(`https://api.rss2json.com/v1/api.json?rss_url=https://www.bloomberght.com/rss`);
        const d = await r.json();
        document.getElementById('news-list').innerHTML = d.items.slice(0,8).map(i => `<div style="padding:10px; border-bottom:1px solid #eee;"><a href="${i.link}" target="_blank" style="text-decoration:none; color:black; font-weight:bold;">${i.title}</a></div>`).join('');
    }

    setInterval(() => { document.getElementById('clock').innerText = new Date().toLocaleTimeString(); }, 1000);
    fetchAll();
    setInterval(fetchAll, 60000);
</script>
</body>
</html>
