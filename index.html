<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Finans Sepeti | Profesyonel Terminal</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        :root {
            --bg: #e0e5ec;
            --shadow: 9px 9px 16px rgb(163,177,198,0.6), -9px -9px 16px rgba(255,255,255, 0.5);
            --inner-shadow: inset 6px 6px 12px #a3b1c6, inset -6px -6px 12px #ffffff;
            --accent: #1a237e;
        }

        body { font-family: 'Poppins', sans-serif; background: var(--bg); margin: 0; color: #444; }
        
        header { 
            padding: 30px; text-align: center; background: var(--bg); box-shadow: var(--shadow); 
            border-bottom: 2px solid rgba(255,255,255,0.3);
        }
        
        .nav-tabs { display: flex; justify-content: center; gap: 15px; padding: 20px; sticky: top; background: var(--bg); z-index: 1000; }
        .tab-btn { 
            padding: 12px 25px; border: none; border-radius: 12px; background: var(--bg); 
            box-shadow: var(--shadow); cursor: pointer; font-weight: 600; display: flex; align-items: center; gap: 8px;
        }
        .tab-btn.active { box-shadow: var(--inner-shadow); color: var(--accent); }

        .container { padding: 20px; max-width: 1400px; margin: auto; }
        
        /* 3D Kartlar */
        .card { background: var(--bg); padding: 25px; border-radius: 20px; box-shadow: var(--shadow); margin-bottom: 20px; }
        
        /* Piyasa Widgetları */
        .market-ticker { height: 450px; border-radius: 20px; overflow: hidden; box-shadow: var(--inner-shadow); }

        /* Yatırım Ekle Formu */
        input, select { 
            width: 100%; padding: 15px; margin: 10px 0; border: none; border-radius: 12px; 
            background: var(--bg); box-shadow: var(--inner-shadow); font-size: 1rem;
        }
        .calc-box { 
            background: #1a237e; color: #fff; padding: 25px; border-radius: 15px; 
            text-align: center; font-size: 1.5rem; font-weight: 800; margin: 20px 0;
            box-shadow: 0 10px 20px rgba(0,0,0,0.2); border-left: 10px solid #00e676;
        }

        .page { display: none; }
        .page.active { display: block; }

        /* Haber Kartları */
        .news-card { padding: 15px; border-radius: 12px; background: var(--bg); box-shadow: var(--shadow); margin-bottom: 15px; }
    </style>
</head>
<body>

<header>
    <h3 style="letter-spacing: 2px; opacity: 0.7;">FİNANSAL YATIRIM VE TEKNİK ANALİZ</h3>
    <h1 id="clock">00:00:00</h1>
</header>

<div class="nav-tabs">
    <button class="tab-btn active" onclick="showPage('piyasalar')"><i class="fas fa-chart-line"></i> Piyasalar</button>
    <button class="tab-btn" onclick="showPage('yatirim-ekle')"><i class="fas fa-plus-circle"></i> Yatırım Ekle</button>
    <button class="tab-btn" onclick="showPage('portfoyum')"><i class="fas fa-wallet"></i> Portföyüm</button>
    <button class="tab-btn" onclick="showPage('teknik-analiz')"><i class="fas fa-microchip"></i> Teknik Analiz</button>
    <button class="tab-btn" onclick="showPage('haberler')"><i class="fas fa-newspaper"></i> Haberler</button>
</div>

<div class="container">
    
    <div id="piyasalar" class="page active">
        <div class="card market-ticker">
            <div class="tradingview-widget-container">
                <div class="tradingview-widget-container__widget"></div>
                <script type="text/javascript" src="https://s3.tradingview.com/external-embedding/embed-widget-market-overview.js" async>
                {
                "colorTheme": "light",
                "dateRange": "12M",
                "showChart": true,
                "locale": "tr",
                "width": "100%",
                "height": "100%",
                "largeChartUrl": "",
                "isTransparent": true,
                "showSymbolLogo": true,
                "tabs": [
                    {
                    "title": "Piyasalar",
                    "symbols": [
                        {"s": "OANDA:XAUUSD", "d": "Altın/Ons"},
                        {"s": "OANDA:XAGUSD", "d": "Gümüş/Ons"},
                        {"s": "FX:USDTRY", "d": "Dolar/TL"},
                        {"s": "FX:EURTRY", "d": "Euro/TL"},
                        {"s": "BIST:XU100", "d": "Bist 100"},
                        {"s": "BIST:XU030", "d": "Bist 30"},
                        {"s": "BINANCE:BTCUSDT", "d": "Bitcoin"},
                        {"s": "BINANCE:ETHUSDT", "d": "Ethereum"}
                    ]
                    }
                ]
                }
                </script>
            </div>
        </div>
    </div>

    <div id="yatirim-ekle" class="page">
        <div class="card" style="max-width: 600px; margin: auto;">
            <h3><i class="fas fa-calculator"></i> Yatırım Hesaplama</h3>
            <label>Varlık Tipi:</label>
            <select id="asset-type" onchange="updateDefaultPrice()">
                <option value="XAUUSD">Altın (Ons)</option>
                <option value="XAGUSD">Gümüş (Ons)</option>
                <option value="BTCUSDT">Bitcoin (BTC)</option>
                <option value="USDTRY">Dolar/TL</option>
                <option value="CUSTOM">Özel (Hisse/Koin)</option>
            </select>
            
            <input type="text" id="manual-symbol" placeholder="Hisse veya Koin Sembolü (Örn: THYAO, SOL)">
            <input type="number" id="asset-qty" placeholder="Miktar (Adet/Gram)" oninput="recalc()">
            <input type="number" id="asset-price" placeholder="Birim Alış Fiyatı" oninput="recalc()">
            
            <div class="calc-box">
                TOPLAM YATIRIM: <span id="total-val">0.00</span> ₺
            </div>
            
            <input type="date" id="invest-date">
            <button onclick="saveToWallet()" style="width:100%; padding:15px; background:var(--accent); color:white; border:none; border-radius:12px; font-weight:bold; cursor:pointer;">CÜZDANA KAYDET</button>
        </div>
    </div>

    <div id="portfoyum" class="page">
        <div class="card">
            <h3><i class="fas fa-list"></i> Mevcut Portföy</h3>
            <div id="wallet-list">Henüz yatırım eklenmedi.</div>
        </div>
    </div>

    <div id="teknik-analiz" class="page">
        <div class="card market-ticker" id="tv_chart_container" style="height: 700px;"></div>
    </div>

    <div id="haberler" class="page">
        <div id="news-container"></div>
    </div>
</div>

<script type="text/javascript" src="https://s3.tradingview.com/tv.js"></script>
<script>
    function showPage(id) {
        document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        if(id === 'teknik-analiz') loadAdvancedChart();
        if(id === 'haberler') fetchRSSNews();
    }

    // MATEMATİKSEL HESAPLAMA (KESİN ÇÖZÜM)
    function recalc() {
        const qty = parseFloat(document.getElementById('asset-qty').value) || 0;
        const price = parseFloat(document.getElementById('asset-price').value) || 0;
        const total = qty * price;
        document.getElementById('total-val').innerText = total.toLocaleString('tr-TR', {minimumFractionDigits: 2});
    }

    // TEKNİK ANALİZ (TAM YETKİLİ)
    function loadAdvancedChart() {
        new TradingView.widget({
            "autosize": true,
            "symbol": "BIST:XU100",
            "interval": "D",
            "timezone": "Europe/Istanbul",
            "theme": "light",
            "style": "1",
            "locale": "tr",
            "toolbar_bg": "#f1f3f6",
            "enable_publishing": false,
            "allow_symbol_change": true,
            "hide_side_toolbar": false,
            "studies": ["RSI@tv-basicstudies", "MASimple@tv-basicstudies", "MASimple@tv-basicstudies"],
            "container_id": "tv_chart_container"
        });
    }

    // HABERLER
    async function fetchRSSNews() {
        const newsContainer = document.getElementById('news-container');
        try {
            const res = await fetch('https://api.rss2json.com/v1/api.json?rss_url=https://www.bloomberght.com/rss');
            const data = await res.json();
            newsContainer.innerHTML = data.items.slice(0, 10).map(item => `
                <div class="news-card">
                    <small>${item.pubDate}</small>
                    <h4 style="margin: 5px 0;"><a href="${item.link}" target="_blank" style="text-decoration:none; color:#1a237e;">${item.title}</a></h4>
                </div>
            `).join('');
        } catch (e) { newsContainer.innerText = "Haberler yüklenemedi."; }
    }

    setInterval(() => { document.getElementById('clock').innerText = new Date().toLocaleTimeString(); }, 1000);
</script>
</body>
</html>
